# Собственная система аутентификации и авторизации

**Полностью кастомная** система аутентификации и авторизации, реализованная **без использования встроенных механизмов фреймворков** (например, Django Auth, Flask-Login). Система использует надёжную модель **контроля доступа на основе ролей (RBAC)** с JWT-аутентификацией и удобным веб-интерфейсом для тестирования.

---

## Возможности

### 1. Взаимодействие с пользователем
- **Регистрация**: Имя, фамилия, отчество, email, пароль
- **Вход/Выход**: Безопасная аутентификация с JWT-токенами и серверным logout через блокировку токенов
- **Управление профилем**: Редактирование личной информации
- **Мягкое удаление аккаунта**: Учётная запись остаётся в БД со статусом `is_active=False`
- **Постоянная идентификация**: Авторизованный пользователь распознаётся при последующих запросах

### 2. Система разграничения прав доступа
- **Архитектура RBAC**: Пользователи → Роли → Разрешения
- **Гибкие разрешения**: Определяются как пары `(ресурс, действие)` (например, `document:read`)
- **Стандартизированные ошибки**:
  - `401 Unauthorized`: Отсутствует или неверна аутентификация
  - `403 Forbidden`: Пользователь аутентифицирован, но не имеет нужного разрешения
- **Админка через API**: Полный CRUD для ролей и разрешений
- **Тестовые данные**: Готовые учётные записи админа и редактора

### 3. Бизнес-объекты (Mock)
- **Документы**: Защищённый ресурс с действиями чтения/записи/удаления
- **Управление пользователями**: Только для администраторов

---

## Схема управления доступом

### Основные сущности
| Сущность | Описание |
|----------|----------|
| **Пользователь** | Учётная запись с флагом `is_active` для мягкого удаления |
| **Роль** | Одна роль на пользователя (например, `admin`, `editor`, `viewer`) |
| **Разрешение** | Атомарное право в виде `(ресурс, действие)` |

### Примеры разрешений
| Ресурс | Действие | Описание |
|--------|----------|----------|
| `document` | `read` | Просмотр документов |
| `document` | `write` | Создание/редактирование документов |
| `document` | `delete` | Удаление документов |
| `user` | `read` | Просмотр профилей |
| `user` | `write` | Редактирование профиля |
| `permission` | `manage` | Управление ролями и разрешениями (только для админа) |

### Стандартные роли
| Роль | Разрешения |
|------|------------|
| **admin** | Все разрешения |
| **editor** | `document:read/write`, `user:read/write` |
| **viewer** | `document:read`, `user:read` |

> **Важно**: Проверка прав происходит при каждом обращении к защищённому ресурсу. Управлять ролями могут только пользователи с разрешением `permission:manage`.

---

## Быстрый старт

### Требования
- Python 3.8+
- Docker (опционально)

### Локальный запуск
```bash
# Клонировать репозиторий
git clone ttps://github.com/IlyaKulishkin/Auth-System
cd auth_system

# Установить зависимости
pip install -r requirements.txt

# Запустить приложение
python main.py
```

### Запуск в Docker
```bash
# Собрать и запустить
docker build -t auth-system .
docker run -p 5000:5000 auth-system
```

### Тестовые учётные данные
| Роль | Email | Пароль |
|------|-------|--------|
| Админ | `admin@example.com` | `admin123` |
| Редактор | `editor@example.com` | `editor123` |

> **Примечание**: База данных (`auth_demo.db`) автоматически создаётся при первом запуске с тестовыми данными.

---

## Веб-интерфейс

Доступ по: [http://localhost:5000](http://localhost:5000)

- **Возможности пользователя**:
  - Регистрация/вход/выход
  - Редактирование профиля
  - Управление документами
- **Возможности администратора**:
  - Назначение ролей пользователям
  - Полный CRUD для ролей и разрешений
  - Просмотр списка пользователей

---

## API-эндпоинты

### Аутентификация
| Метод | Эндпоинт | Описание |
|--------|----------|----------|
| POST | `/register` | Создание аккаунта |
| POST | `/login` | Получение JWT-токена |
| POST | `/logout` | Отзыв текущего токена |

### Управление пользователями
| Метод | Эндпоинт | Описание |
|--------|----------|----------|
| GET | `/me` | Получение профиля текущего пользователя |
| PUT | `/profile` | Обновление профиля |
| POST | `/delete-account` | Мягкое удаление аккаунта |

### Бизнес-ресурсы
| Метод | Эндпоинт | Требуемое разрешение |
|--------|----------|----------------------|
| GET | `/documents` | `document:read` |
| POST | `/documents` | `document:write` |

### Админка
| Метод | Эндпоинт | Требуемое разрешение |
|--------|----------|----------------------|
| GET | `/admin/users` | `user:read` |
| POST | `/admin/assign-role` | `permission:manage` |
| GET/POST/PUT/DELETE | `/admin/roles` | `permission:manage` |
| GET | `/admin/permissions` | `permission:manage` |

---

## Структура базы данных

**Основные таблицы**:
- `user` (id, email, first_name, last_name, patronymic, is_active, role_id)
- `role` (id, name)
- `permission` (id, resource, action)
- `role_permissions` (role_id, permission_id)
- `token_blocklist` (jti, created_at)

>  **Примечание**: База данных SQLite создаётся автоматически при первом запуске. Для продакшена рекомендуется использовать PostgreSQL.

---

## Используемые технологии

- **Бэкенд**: Python 3.11, Flask 3.0
- **База данных**: SQLAlchemy 2.0 (SQLite)
- **Безопасность**: JWT (PyJWT), BCrypt
- **Фронтенд**: HTML/JS
- **DevOps**: Docker

>  **Ключевое достижение**: Полный отказ от встроенных механизмов аутентификации фреймворков — вся логика реализована с нуля.

---

## Дополнительные детали

- Тестовые данные генерируются автоматически при первом запуске
- Пароли хешируются с использованием BCrypt
- JWT-токены отзываются на сервере при выходе

---
